# furyTerminalæ–‡æ¡£

ç›®å½•

---

1. [ç®€ä»‹](#ç®€ä»‹)
   1. [æ–‡æ¡£ç›®çš„](#æ–‡æ¡£ç›®çš„)
   2. [å‘èµ·æ—¶é—´](#å‘èµ·æ—¶é—´)
   3. [è§„åˆ’](#è§„åˆ’)
      1. [TODO](#todo)
      2. [FIXME](#fixme)
      3. [Milestone](#milestone)
   4. [ç³»ç»Ÿç›®æ ‡](#ç³»ç»Ÿç›®æ ‡)
   5. [ç³»ç»Ÿç¯å¢ƒ](#ç³»ç»Ÿç¯å¢ƒ)
2. [CANè½¬SPIæ¨¡å—](#canè½¬spiæ¨¡å—)
3. [DSIæ¥å£çš„7å¯¸è§¦æ‘¸æ˜¾ç¤ºå±](#dsiæ¥å£çš„7å¯¸è§¦æ‘¸æ˜¾ç¤ºå±)
4. [è½¦è½½ç½‘ç«™ (äº¤äº’å¹³å°)](#è½¦è½½ç½‘ç«™-äº¤äº’å¹³å°)
   1. [å¦‚æ­¤é€‰æ‹©çš„ä¼˜ç¼ºç‚¹](#å¦‚æ­¤é€‰æ‹©çš„ä¼˜ç¼ºç‚¹)
      1. [Django](#django)
         1. [ä¼˜ç‚¹](#ä¼˜ç‚¹)
         2. [ç¼ºç‚¹](#ç¼ºç‚¹)
      2. [Bootstrap](#bootstrap)
         1. [ä¼˜ç‚¹](#ä¼˜ç‚¹-1)
         2. [ç¼ºç‚¹](#ç¼ºç‚¹-1)
   2. [ç®¡ç†](#ç®¡ç†)
   3. [oncar](#oncar)
      1. [oncarè®¾è®¡](#oncarè®¾è®¡)
   4. [djangoçºªè¦](#djangoçºªè¦)
      1. [è®¾ç½®å…è®¸è®¿é—®çš„åœ°å€](#è®¾ç½®å…è®¸è®¿é—®çš„åœ°å€)
      2. [è®¾ç½®åå°æ—¶é—´æ˜¾ç¤ºæ ¼å¼](#è®¾ç½®åå°æ—¶é—´æ˜¾ç¤ºæ ¼å¼)
      3. [è®¾ç½®å­—æ®µä¸å¯ä¿®æ”¹](#è®¾ç½®å­—æ®µä¸å¯ä¿®æ”¹)
      4. [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
         1. [è¿è¡Œç½‘ç«™](#è¿è¡Œç½‘ç«™)
         2. [ç”Ÿæˆåº”ç”¨çš„è¿ç§»](#ç”Ÿæˆåº”ç”¨çš„è¿ç§»)
         3. [åº”ç”¨è¿ç§»åˆ°ç½‘ç«™](#åº”ç”¨è¿ç§»åˆ°ç½‘ç«™)
         4. [database API](#database-api)
            1. [è¿›å…¥ä¸“ç”¨pythonè§£é‡Šå™¨](#è¿›å…¥ä¸“ç”¨pythonè§£é‡Šå™¨)
            2. [æ·»åŠ è®°å½•](#æ·»åŠ è®°å½•)
      5. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## ç®€ä»‹

### æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£æ˜¯furyTerminalç³»ç»Ÿæ€»ä½“å’Œå„éƒ¨åˆ†è¯´æ˜, ä¸»è¦é¢å‘ç”µæ°”ç»„å¼€å‘äººå‘˜, å…¶ä»–ç»„æˆå‘˜ä¸åº”éœ€è¦é˜…è¯»
æœ¬æ–‡æ¡£, ç³»ç»Ÿå®ç°çš„åº”å½“æ˜¯ååˆ†å‹å¥½ (å‚»ç“œå¼) çš„äº¤äº’ğŸ˜

### å‘èµ·æ—¶é—´

2019-02-01

### è§„åˆ’

#### TODO

- å¼€æœºåŠ¨ç”». å¯å‚è€ƒ ğŸ”—[YouTubeä¸Šä¸€ä¸ªäººç»™æ ‘è“æ´¾æ¢Spalsh Screen](https://www.youtube.com/watch?v=VK_eBe53Stc)
- æ·»åŠ  oncar ç•Œé¢çš„å†…å®¹, è¯¦æƒ…å‚è§[oncaré¢æ¿è®¾è®¡è‰ç¨¿](doc/furyTerminal/oncar/é¢æ¿è®¾è®¡è‰ç¨¿.md)
- ç¦æ­¢å³é”®èœå•. å¯å‚è€ƒ ğŸ”—[è¿™ä¸ªç™¾åº¦çŸ¥é“](https://jingyan.baidu.com/article/ed2a5d1fac6f6c09f6be179b.html)
- æ ‘è“æ´¾å¼€æœºè‡ªå¯æŒ‡å®šç½‘é¡µ. å¯å‚è€ƒ ğŸ”—[è¿™é‡Œ](https://blog.csdn.net/szu_Vegetable_Bird/article/details/80231660)

#### FIXME

- oncarç•Œé¢éƒ¨åˆ†æ•°æ® (è½¦é€Ÿ, æ²¹é—¨ç­‰) åˆ·æ–°ä¸åŠæ—¶, æš‚æ—¶æœ‰ä»¥ä¸‹ä¸¤ç§è§£å†³æ€è·¯:
  - æ€€ç–‘æ˜¯åç«¯æ•°æ®åº“æ›´æ–°æ•°æ®å¤ªé¢‘ç¹å¯¼è‡´å‰ç«¯è¯·æ±‚é€Ÿåº¦è¿‡æ…¢, è€ƒè™‘ä¸ä»æ•°æ®åº“è¯·æ±‚æ•°æ®, å³, å…ˆå°†ä¼ æ„Ÿå™¨
    è¯»åˆ°çš„æ•°æ®å‘é€ç»™model, è¿™æ ·modelä¸éœ€è¦ä»åç«¯è¯»å–æ•°æ®, å¦ä¸€æ–¹é¢åç«¯è®°å½•çš„æ•°æ®å¯†åº¦ä¹Ÿè®¸ä¸éœ€è¦è¿™ä¹ˆå¤§
- è€ƒè™‘ä½¿ç”¨websocket
å‚è€ƒ ğŸ”—
- [åç«¯ä¸»åŠ¨å‘å‰æ®µæ¨é€æ¶ˆæ¯çš„å‡ ç§æ–¹å¼ï¼ˆè½¬ï¼‰](https://blog.csdn.net/justyou_and_me/article/details/88218199)
- [çŸ¥ä¹-æœåŠ¡ç«¯æ˜¯å¦‚ä½•ä¸»åŠ¨æ¨é€ä¿¡æ¯åˆ°å®¢æˆ·ç«¯çš„ï¼Ÿ](https://www.zhihu.com/question/24938934)
- [æœåŠ¡å™¨æœ‰æ–°æ¶ˆæ¯ä¸»åŠ¨æ¨é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨](https://blog.csdn.net/qq_35448976/article/details/78783698)

#### Milestone

- ä¸ºæ¯ä¸ªè½¦æ‰‹å»ºç«‹è´¦å·åˆ†åˆ«è®°å½•æ•°æ®
- å°†æ¯æ¬¡è·‘åŠ¨çš„æ—¶é—´, é€Ÿç‡, æ–¹å‘, æ²¹é—¨, åˆ¹è½¦, ç”µé‡ç­‰å…³è”èµ·æ¥, è¾¾åˆ°è¿˜åŸæ•´æ¬¡è·‘åŠ¨çš„æ•ˆæœ, æ–¹ä¾¿å®æ—¶/
  åæœŸçš„åˆ†æ
- è¯­éŸ³æç¤º

### ç³»ç»Ÿç›®æ ‡

å‘½åä¸ºfuryTerminalæ˜¯å› ä¸ºæœ¬ç³»ç»Ÿçš„ç›®æ ‡æ˜¯åšå‡ºä¸€ä¸ª **å‹å¥½, ç›´è§‚, å¥å£®** çš„èµ›è½¦
ç»ˆç«¯:

- è®©æ“ä½œæ–¹å¼è¶³å¤Ÿå‹å¥½, è½¦é˜Ÿé˜Ÿå‘˜ä»¬èƒ½é€šè¿‡ç®€å•æ“ä½œæ¥è·å–æ•°æ®æˆ–è€…æ›´æ”¹å‚æ•°
- æ•°æ®å‘ˆç°æ–¹å¼, äº¤äº’æ–¹å¼è¶³å¤Ÿç›´è§‚, é€Ÿåº¦, æ²¹é—¨, æ—¶é—´ç­‰è½¦æ‰‹å¸¸ç”¨æ•°æ®æ˜æ˜¾, æ•…éšœåŸå› æç¤ºå†…å®¹
  è¶³å¤Ÿç›´è§‚, åˆ†æç”¨æ•°æ®ä»¥å›¾è¡¨å½¢å¼å‘ˆç°
- ç³»ç»Ÿè¶³å¤Ÿå¥å£®, èƒ½å¤Ÿåº”å¯¹ç»å¤§å¤šæ•°æ•…éšœæƒ…å†µ, æ¯”å¦‚æ‰ç”µæ•°æ®å‚¨å­˜ç­‰.

è‡³äºä»€ä¹ˆæ˜¯ç»ˆç«¯ (Terminal), å‚è§ ğŸ”— [è¿™é‡Œ](https://www.zhihu.com/question/21711307/answer/118788917)

![ç³»ç»Ÿè“å›¾](doc/è“å›¾.png)

### ç³»ç»Ÿç¯å¢ƒ

`Linux` version: 4.14.34-v7+ (dc4@dc4-XPS13-9333) (gcc version 4.9.3 (crosstool-NG crosstool-ng-1.22.0-88-g8460611)) #1110 SMP Mon Apr 16 15:18:51 BST 2018

`Raspbian` version: Raspbian GNU/Linux 9.6 (stretch)

â—ï¸ å½“å‰ä½¿ç”¨[ä¸­ç§‘å¤§æº](https://lug.ustc.edu.cn/wiki/mirrors/help/raspbian)

`python` version: Python 3.5.3 (default, Sep 27 2018, 17:25:39) [GCC 6.3.0 20170516] on linux

ğŸ’¡ å½“å‰ç³»ç»Ÿé»˜è®¤pythonä¸º 3.5.3, è‹¥æƒ³å°†ç³»ç»Ÿé»˜è®¤pythonåˆ‡æ¢å›python2, è¿è¡Œä»¥ä¸‹å‘½ä»¤ç„¶åè·Ÿéš
æŒ‡å¯¼æ“ä½œ.

```shell
sudo update-alternatives --config python
```

âš ï¸éœ€æ³¨æ„pipçš„ç‰ˆæœ¬ä¸pythonç‰ˆæœ¬ç›¸åŒ¹é…, é€šè¿‡è¿è¡Œ `pip -V` æ¥æŸ¥çœ‹pipç‰ˆæœ¬å’Œä½ç½®

`django` version: 2.1.7

## CANè½¬SPIæ¨¡å—

ğŸ“‘ [RS485 CAN HATç”¨æˆ·æ‰‹å†Œ](doc/CAN2SPI/CAN_to_SPI_module/RS485-CAN-HAT-user-manual-cn.pdf)

ğŸ“‘ [RS485 CAN HATç”µè·¯å›¾](doc/CAN2SPI/CAN_to_SPI_module/RS485_CAN_HAT_Schematic.pdf)

ğŸ”— [python-canæ–‡æ¡£](https://python-can.readthedocs.io/en/master/index.html#)

## DSIæ¥å£çš„7å¯¸è§¦æ‘¸æ˜¾ç¤ºå±

ğŸ“‘ [7å¯¸è§¦æ‘¸å±è¯´æ˜ä¹¦](doc/display/7å¯¸è§¦æ‘¸å±è¯´æ˜ä¹¦.md)

## è½¦è½½ç½‘ç«™ (äº¤äº’å¹³å°)

æœ¬ç½‘ç«™åŸºäº **Django** æ¡†æ¶å’Œ **Bootsrap** æ¡†æ¶.

### å¦‚æ­¤é€‰æ‹©çš„ä¼˜ç¼ºç‚¹

#### Django

##### ä¼˜ç‚¹

- æ˜¯ä¸€ä¸ªpythonæ¡†æ¶, æ•°æ®å¤„ç†å¾ˆæ–¹ä¾¿.
- å®¹æ˜“ä¸Šæ‰‹. ä¸ªäººè®¤ä¸ºç»“åˆäº†å‰åç«¯, æ›´åå‘åç«¯, ä½†å‰ç«¯èƒ½å¾ˆå®¹æ˜“çš„ç»“åˆå‰ç«¯

##### ç¼ºç‚¹

æš‚æ—¶ä¸çŸ¥é“

#### Bootstrap

##### ä¼˜ç‚¹

- å®¹æ˜“ä¸Šæ‰‹ğŸ˜…æ˜¯çš„ä¸å¥½æ„æ€æˆ‘å¤ªèœäº†
- ä½¿ç”¨å®¹æ˜“. åªè¦åœ¨ HTML é¡µé¢ä¸­æ’å…¥ Bootstrap å®˜ç½‘ç»™å‡ºçš„æ¨¡æ¿å³å¯.
- è¢«å¹¿æ³›ä½¿ç”¨, ç®€æ´å¥½çœ‹

##### ç¼ºç‚¹

- è¢«ä¸€äº›åšå‰ç«¯çš„ç¨‹åºå‘˜è®¤ä¸ºä¸èƒ½å¤Ÿä½œå‡ºå¾ˆç‚«æŠ€çš„æ•ˆæœ, æ˜¯åç«¯å¼€å‘è€…ç”¨çš„ä¸œè¥¿.

ğŸ‘‡ä¸€äº›æ¨èçš„å­¦ä¹ èµ„æ–™

ğŸ”— [HTMLæ•™ç¨‹](https://www.w3schools.com/html/default.asp)  
ğŸ”— [CSSæ•™ç¨‹](https://www.w3schools.com/css/default.asp)  
ğŸ”— [Bootstrapæ•™ç¨‹](https://www.w3schools.com/bootstrap4/default.asp)  
ğŸ”— [Bootstrapå®˜æ–¹æ–‡æ¡£](https://getbootstrap.com/docs/4.3/getting-started/introduction/)  
ğŸ”— [JavaScriptæ•™ç¨‹](https://www.w3schools.com/js/default.asp)  
ğŸ”— [Djangoä¸­æ–‡æ–‡æ¡£](https://docs.djangoproject.com/zh-hans/2.1/)

### ç®¡ç†

ç®¡ç†å‘˜è´¦å·: leo

å¯†ç : 111111

### oncar

#### oncarè®¾è®¡

ğŸ“ [oncaré¢æ¿è®¾è®¡è‰ç¨¿](doc/furyTerminal/oncar/é¢æ¿è®¾è®¡è‰ç¨¿.md)

### djangoçºªè¦

#### è®¾ç½®å…è®¸è®¿é—®çš„åœ°å€

åœ¨ `furyTerminal/furyTerminal/settings.py` ä¸­ **ALLOWED_HOSTS**ä¸€é¡¹è®¾ç½®äº†å…è®¸è®¿é—®
ç½‘ç«™çš„åœ°å€, è®¾ä¸º `'*'` åˆ™æ˜¯å…è®¸æ‰€æœ‰åœ°å€è®¿é—®.

#### è®¾ç½®åå°æ—¶é—´æ˜¾ç¤ºæ ¼å¼

ğŸ”— [å¯ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦](https://docs.djangoproject.com/en/2.0/ref/templates/builtins/#date)
ğŸ”— å…·ä½“å‚è€ƒ[è¿™é‡Œ](https://blog.51cto.com/xujpxm/2090382)

#### è®¾ç½®å­—æ®µä¸å¯ä¿®æ”¹

åœ¨å¯¹åº”çš„çˆ¶ç±»ä¸º **admin.ModelAdmin** çš„ç±»ä¸‹é‡å†™ `get_readonly_fields`æ–¹æ³•å¦‚ä¸‹:

```python
def get_readonly_fields(self, request, obj=None):
    if obj:  # obj is not None, so this is an edit
        return ['[readonly_fields]']  # Return a list or tuple of readonly fields' names
    else:  # This is an addition
        return []
```

ğŸ”— [å‚è€ƒ](https://stackoverflow.com/questions/7860612/django-admin-make-field-editable-in-add-but-not-edit)

#### å¸¸ç”¨å‘½ä»¤

ğŸ’¡ å› ä¸ºæˆ‘è®°æ€§å¾ˆå·®, æœ€å¸¸ç”¨çš„å‡ ä¸ªæ¯”è¾ƒé•¿çš„å‘½ä»¤æˆ‘å†™æˆäº†shellè„šæœ¬æ”¾åœ¨ **/scripts** æ–‡ä»¶å¤¹ä¸­

##### è¿è¡Œç½‘ç«™

âš ï¸ åœ¨ç½‘ç«™æ ¹ç›®å½•æ‰§è¡Œ.
ğŸ’¡æ­¤æ—¶ä¸ºç½‘ç«™åœ¨ **localhost:8000** è¿è¡Œ

```shell
python furyTerminal/manage.py runserver 0:8000
```

##### ç”Ÿæˆåº”ç”¨çš„è¿ç§»

```shell
python manage.py makemigrations
```

##### åº”ç”¨è¿ç§»åˆ°ç½‘ç«™

âš ï¸ åœ¨ç½‘ç«™æ ¹ç›®å½•æ‰§è¡Œ.

```shell
python manage.py migrate
```

##### database API

###### è¿›å…¥ä¸“ç”¨pythonè§£é‡Šå™¨

> æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è€Œä¸æ˜¯ç®€å•çš„ä½¿ç”¨ "Python" æ˜¯å› ä¸º **manage.py** ä¼šè®¾ç½®
> **DJANGO_SETTINGS_MODULE** ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªå˜é‡ä¼šè®© Django æ ¹æ® **mysite/settings.py**
> æ–‡ä»¶æ¥è®¾ç½® Python åŒ…çš„å¯¼å…¥è·¯å¾„ã€‚

```shell
python manage.py shell
```

ğŸ’¡å¦‚æœæƒ³é€šè¿‡è„šæœ¬è°ƒç”¨ database API, éœ€è¦åœ¨è„šæœ¬å¼€å¤´åŠ ä¸Šä»¥ä¸‹è¯­å¥:

```python
from furyTerminal import settings
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'furyTerminal.settings')
django.setup()
```

å…·ä½“ä¾‹å­å‚è§[oncaråº”ç”¨çš„Speedéƒ¨åˆ†çš„æµ‹è¯•](/oncar/test/speed/create.py)

###### æ·»åŠ è®°å½•

ä¸¾ä¾‹: å‘ **oncar** åº”ç”¨çš„ **Speed** æ¨¡å‹æ·»åŠ è®°å½•

1.é¦–å…ˆå½“ç„¶æ˜¯å¼•ç”¨å®ƒ

```python
from oncar.models import Speed
```

2.æœ‰ä¸¤ç§æ·»åŠ æ–¹æ³•:

   1. å…ˆå®ä¾‹åŒ–ç„¶åä¿å­˜ ğŸ”—[save()](https://docs.djangoproject.com/zh-hans/2.1/topics/db/queries/)

      ```python
      speeed = Speed(speed_value='123')
      speeed.save()
      ```

   2. ç›´æ¥åˆ›å»º ğŸ”—[creat()](https://docs.djangoproject.com/zh-hans/2.1/ref/models/querysets/#django.db.models.query.QuerySet.create)

      ```python
      Speed.objects.create(speed_value='123')
      ```

#### æ³¨æ„äº‹é¡¹

- path()å‡½æ•°çš„å‚æ•°`route`ä¸ä¼šåŒ¹é… GET å’Œ POST å‚æ•°æˆ–åŸŸåã€‚ä¾‹å¦‚ï¼ŒURLconf åœ¨å¤„ç†è¯·æ±‚
  https://www.example.com/myapp/ æ—¶ï¼Œå®ƒä¼šå°è¯•åŒ¹é… myapp/ ã€‚å¤„ç†è¯·æ±‚
  https://www.example.com/myapp/?page=3 æ—¶ï¼Œä¹Ÿåªä¼šå°è¯•åŒ¹é… myapp/ã€‚
- ğŸ”—[djangoæ¨¡å‹ä¸­auto_nowå’Œauto_now_addçš„åŒºåˆ«](https://www.cnblogs.com/vincenshen/articles/7659763.html)